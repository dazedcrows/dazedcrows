!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TezignTracerNew=e()}(this,function(){"use strict";function N(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){e&&j(t.prototype,e),n&&j(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(n),e=(t=i?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}}function h(t){for(var e=1;e<arguments.length;e++){var n,i=arguments[e];for(n in i)t[n]=i[n]}return t}var z=function e(a,r){function n(t,e,n){if("undefined"!=typeof document){"number"==typeof(n=h({},r,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i,o="";for(i in n)n[i]&&(o+="; "+i,!0!==n[i]&&(o+="="+n[i].split(";")[0]));return document.cookie=t+"="+a.write(e,t)+o}}return Object.create({set:n,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var e=document.cookie?document.cookie.split("; "):[],n={},i=0;i<e.length;i++){var o=e[i].split("="),r=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(n[s]=a.read(r,s),t===s)break}catch(t){}}return t?n[t]:n}},remove:function(t,e){n(t,"",h({},e,{expires:-1}))},withAttributes:function(t){return e(this.converter,h({},this.attributes,t))},withConverter:function(t){return e(h({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(a)}})}({read:function(t){return(t='"'===t[0]?t.slice(1,-1):t).replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});(function(t){var e,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,u=Object.prototype.hasOwnProperty,n=(n=>(t,e)=>n&&n.get(t)||(e=((e,n,i,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let t of a(n))u.call(e,t)||!i&&"default"===t||r(e,t,{get:()=>n[t],enumerable:!(o=s(n,t))||o.enumerable});return e})(r({},"__esModule",{value:!0}),t,1),n&&n.set(t,e),e))("undefined"!=typeof WeakMap?new WeakMap:0),i={},o=i,c={default:()=>h};for(e in c)r(o,e,{get:c[e],enumerable:!0});var l={AI_CONTACTER_TEXT1:"您的账户尚未配置渠道信息，请与特赞联系",AI_CONTACTER_TEXT2:"此步骤需配置真实渠道账号，请联系特1赞",AI_EYE_TEXT:"Tezign.EYE 正在思考中...",API_ORIGIN:"https://vms-service.tezign.com",API_SOCKET:"wss://vms-service.tezign.com",STATIC_DOMAIN:"https://static.tezign.com",GLOBAL_API_ORIGIN:"https://service.tezign.com",USER_DOMAIN:"https://id.tezign.com",GET_UPLOAD_FEED_URL:"https://vms-service.tezign.com/resource-center/osService/public/policy",GET_TENANT_CLOUD_SERVICE_PROVIDE_URL:"https://vms-service.tezign.com/resource-center/osService/public/getOsBasicInfo",UPLOAD_RESOURCE_URL:"https://vms-service.tezign.com/resource-center/resBaseInfo/createResource",PREVIEW_PAGE_FOR_3D:"https://itg-static.tezign.com/3d-viewer",FZSSJW:"https://tezign-static.oss-cn-shanghai.aliyuncs.com/fonts/FZSSJW.TTF",LOADING_GIF_URL:"https://static.tezign.com/tezign-web-enterprise/images/loading-3f07cfc55a8ccef8eea21ac83400bf24.gif",OW365:"https://x2.ow365.cn/?i=21645&ssl=1&furl=",TEZIGN_WEB_TRACER_DISABLED:!1,BUCKET_KEY_FOR_3D:"bucketKey",SUPPLIER_MINING_ENGINE:"数据来自特赞数据挖掘引擎 Tezign Mind",SUPPLIER_MINING_ENGINE_EN:"Data come from the Tezign Mind -- a data mining engine",ALIYUN_SDK_URL:"https://gosspublic.alicdn.com/aliyun-oss-sdk-6.8.0.min.js",TENCENT_SDK_URL:"https://unpkg.com/cos-js-sdk-v5/dist/cos-js-sdk-v5.min.js",SUPPORT_EMAIL:"support@tezign.com",TRACK_API:"https://track-api.tezign.com/trackEvent"},h={config:(null==window?void 0:window.$config)||{},setValue(t,e){this.config[t]=e},value(t){var e;return"undefined"!=typeof window||this.config[t]||console.error("dont support get tenant-config, please setValue first"),null!=(e=null!=(e=this.config[t])?e:l[t])?e:(console.error(`【tenant-config】get ${t} value empty`),"")}};t.exports=n(i)})(e={exports:{}});function H(){var t,e,n=navigator.userAgent.toLowerCase(),i={versions:"unknown",type:"unknown",userAgent:"unknown"},o={IE:"undefined"!=typeof window&&((null==(t=window)?void 0:t.ActiveXObject)||"ActiveXObject"in window),Chrome:-1<n.indexOf("chrome")&&-1<n.indexOf("safari"),Firefox:-1<n.indexOf("firefox"),Opera:-1<n.indexOf("opera"),Safari:-1<n.indexOf("safari")&&-1===n.indexOf("chrome"),Edge:-1<n.indexOf("edge"),QQBrowser:/qqbrowser/.test(n),WeixinBrowser:/MicroMessenger/i.test(n)};for(e in o)if(o[e]){var r,s,a,u,c="";if("IE"===e)var l,c=(null==(l=n.match(/(msie\s|trident.*rv:)([\w.]+)/))?void 0:l[2])||"";else if("Chrome"===e){for(r in navigator.mimeTypes)"application/360softmgrplugin"===navigator.mimeTypes[r].type&&(e="360");c=(null==(l=n.match(/chrome\/([\d.]+)/))?void 0:l[1])||""}else"Firefox"===e?c=(null==(s=n.match(/firefox\/([\d.]+)/))?void 0:s[1])||"":"Opera"===e?c=(null==(s=n.match(/opera\/([\d.]+)/))?void 0:s[1])||"":"Safari"===e?c=(null==(a=n.match(/version\/([\d.]+)/))?void 0:a[1])||"":"Edge"===e?c=(null==(a=n.match(/edge\/([\d.]+)/))?void 0:a[1])||"":"QQBrowser"===e&&(c=(null==(u=n.match(/qqbrowser\/([\d.]+)/))?void 0:u[1])||"");i.type=e,i.versions=c,i.userAgent=n}return i}var f,e=(e=e.exports)&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,F="tz_tracer_visitor",W=/_sn=\w{8}\.\w{6}\.\w{6}_/,d="_sn",p="https://wx-mini-app/",v="https://tt-mini-app/",B=e.value("TRACK_API")||"https://track-api.tezign.com/trackEvent",q=e.value("TRACK_TEST_API")||"https://track-api.test.tezign.com/trackEvent",V="x-lang";(e=f=f||{})[e.web=1]="web",e[e.wx=2]="wx",e[e.tt=3]="tt",e[e.serviceWorker=4]="serviceWorker";function G(){var t,e=navigator.userAgent,n=/(iPhone|Android|Windows Phone)/i.test(navigator.userAgent),i={iPhone:/iPhone/,iPad:/iPad/,Android:/Android/,Windows:/Windows/,Mac:/Macintosh/},o="",r=e;for(t in i)if(i[t].test(e)){o=t;try{"Windows"===t?r=e.split("Windows NT ")[1].split(";")[0]:"Mac"===t?r=e.split("Mac OS X ")[1].split(")")[0]:"iPhone"===t?r=e.split("iPhone OS ")[1].split(" ")[0]:"iPad"===t?r=e.split("iPad; CPU OS ")[1].split(" ")[0]:"Android"===t&&(r=e.split("Android ")[1].split(";")[0])}catch(t){}}return{name:o,version:r,isMobile:n}}function K(t){return null!=t&&t.Intl&&(null==(t=Intl)||null==(t=t.DateTimeFormat())||null==(t=t.resolvedOptions())?void 0:t.timeZone)||"地区未知"}function J(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:16,e="";t--;)e+=X[Math.floor(Math.random()*Y)];return e}var g,n,m,y,X="0123456789abcdefhijklmnopqrstuvwxyz",Y=X.length;function _(){return"".concat(J(8),".").concat(w(),".").concat(w())}function w(){return Math.floor(Date.now()/1e3).toString(36)}function b(t){return parseInt(t,36)}function I(t){try{return t.defaultView&&t.defaultView.frameElement||null}catch(t){return null}}function Q(t){this.time=t.time,this.target=t.target,this.rootBounds=O(t.rootBounds),this.boundingClientRect=O(t.boundingClientRect),this.intersectionRect=O(t.intersectionRect||x()),this.isIntersecting=!!t.intersectionRect;var t=this.boundingClientRect,t=t.width*t.height,e=this.intersectionRect,e=e.width*e.height;this.intersectionRatio=t?Number((e/t).toFixed(4)):this.isIntersecting?1:0}function i(t,e){var n,i,o,e=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(e.root&&1!=e.root.nodeType&&9!=e.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(n=this._checkForIntersections.bind(this),i=this.THROTTLE_TIMEOUT,o=null,function(){o=o||setTimeout(function(){n(),o=null},i)}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(e.rootMargin),this.thresholds=this._initThresholds(e.threshold),this.root=e.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function Z(t,e,n,i){"function"==typeof t.addEventListener?t.addEventListener(e,n,i||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function $(t,e,n,i){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,i||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function k(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?e.width&&e.height?e:{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}:x()}function x(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function O(t){return!t||"x"in t?t:{top:t.top,y:t.top,bottom:t.bottom,left:t.left,x:t.left,right:t.right,width:t.width,height:t.height}}function et(t,e){var n=e.top-t.top,t=e.left-t.left;return{top:n,left:t,height:e.height,width:e.width,bottom:n+e.height,right:t+e.width}}function nt(t,e){for(var n=e;n;){if(n==t)return!0;n=E(n)}return!1}function E(t){var e=t.parentNode;return 9==t.nodeType&&t!=g?I(t):(e=e&&e.assignedSlot?e.assignedSlot.parentNode:e)&&11==e.nodeType&&e.host?e.host:e}function it(t){return t&&9===t.nodeType}function T(){var t=new Date,e=t.getMonth()+1,n=t.getDate(),i=t.getHours(),o=t.getMinutes(),r=t.getSeconds(),s=t.getMilliseconds();return 1<=e&&e<=9&&(e="0"+e),1<=n&&n<=9&&(n="0"+n),0<=i&&i<=9&&(i="0"+i),0<=o&&o<=9&&(o="0"+o),0<=r&&r<=9&&(r="0"+r),1<=s&&s<100&&(s=(Array(3).join("0")+s).slice(-3)),t.getFullYear()+"-"+e+"-"+n+" "+i+":"+o+":"+r+"."+s}"object"==typeof window&&("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):(g=function(){for(var t=window.document,e=I(t);e;)e=I(t=e.ownerDocument);return t}(),n=[],y=m=null,i.prototype.THROTTLE_TIMEOUT=100,i.prototype.POLL_INTERVAL=null,i.prototype.USE_MUTATION_OBSERVER=!0,i._setupCrossOriginUpdater=function(){return m=m||function(t,e){y=t&&e?et(t,e):x(),n.forEach(function(t){t._checkForIntersections()})}},i._resetCrossOriginUpdater=function(){y=m=null},i.prototype.observe=function(e){var t=this._observationTargets.some(function(t){return t.element==e});if(!t){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(e.ownerDocument),this._checkForIntersections()}},i.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._unmonitorIntersections(e.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},i.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},i.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},i.prototype._initThresholds=function(t){t=t||[0];return(t=Array.isArray(t)?t:[t]).sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||1<t)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},i.prototype._parseRootMargin=function(t){t=(t||"0px").split(/\s+/).map(function(t){t=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(t)return{value:parseFloat(t[1]),unit:t[2]};throw new Error("rootMargin must be specified in pixels or percent")});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},i.prototype._monitorIntersections=function(e){var n,i,o,t=e.defaultView;t&&-1==this._monitoringDocuments.indexOf(e)&&(n=this._checkForIntersections,o=i=null,this.POLL_INTERVAL?i=t.setInterval(n,this.POLL_INTERVAL):(Z(t,"resize",n,!0),Z(e,"scroll",n,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in t&&(o=new t.MutationObserver(n)).observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(e),this._monitoringUnsubscribes.push(function(){var t=e.defaultView;t&&(i&&t.clearInterval(i),$(t,"resize",n,!0)),$(e,"scroll",n,!0),o&&o.disconnect()}),t=this.root&&(this.root.ownerDocument||this.root)||g,e!=t&&(t=I(e))&&this._monitorIntersections(t.ownerDocument))},i.prototype._unmonitorIntersections=function(i){var o,t,e=this._monitoringDocuments.indexOf(i);-1!=e&&(o=this.root&&(this.root.ownerDocument||this.root)||g,this._observationTargets.some(function(t){if((e=t.element.ownerDocument)==i)return!0;for(;e&&e!=o;){var e,n=I(e);if((e=n&&n.ownerDocument)==i)return!0}return!1})||(t=this._monitoringUnsubscribes[e],this._monitoringDocuments.splice(e,1),this._monitoringUnsubscribes.splice(e,1),t(),i!=o&&(e=I(i))&&this._unmonitorIntersections(e.ownerDocument)))},i.prototype._unmonitorAllIntersections=function(){var t=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0;for(var e=this._monitoringUnsubscribes.length=0;e<t.length;e++)t[e]()},i.prototype._checkForIntersections=function(){var a,u;!this.root&&m&&!y||(a=this._rootIsInDom(),u=a?this._getRootRect():x(),this._observationTargets.forEach(function(t){var e=t.element,n=k(e),i=this._rootContainsTarget(e),o=t.entry,r=a&&i&&this._computeTargetAndRootIntersection(e,n,u),s=null,t=(this._rootContainsTarget(e)?m&&!this.root||(s=u):s=x(),t.entry=new Q({time:window.performance&&performance.now&&performance.now(),target:e,boundingClientRect:n,rootBounds:s,intersectionRect:r}));o?a&&i?this._hasCrossedThreshold(o,t)&&this._queuedEntries.push(t):o&&o.isIntersecting&&this._queuedEntries.push(t):this._queuedEntries.push(t)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this))},i.prototype._computeTargetAndRootIntersection=function(t,e,n){if("none"!=window.getComputedStyle(t).display){for(var i,o,r=e,s=E(t),a=!1;!a&&s;){var u,c,l,h=null,f=1==s.nodeType?window.getComputedStyle(s):{};if("none"==f.display)return null;if(s==this.root||9==s.nodeType?(a=!0,s==this.root||s==g?m&&!this.root?!y||0==y.width&&0==y.height?r=h=s=null:h=y:h=n:(u=(l=E(s))&&k(l),c=l&&this._computeTargetAndRootIntersection(l,u,n),u&&c?(s=l,h=et(u,c)):r=s=null)):s!=(l=s.ownerDocument).body&&s!=l.documentElement&&"visible"!=f.overflow&&(h=k(s)),h&&(u=h,c=r,o=i=h=f=void 0,f=Math.max(u.top,c.top),h=Math.min(u.bottom,c.bottom),i=Math.max(u.left,c.left),u=Math.min(u.right,c.right),o=h-f,r=0<=(c=u-i)&&0<=o?{top:f,bottom:h,left:i,right:u,width:c,height:o}:null),!r)break;s=s&&E(s)}return r}},i.prototype._getRootRect=function(){var t,e;return e=this.root&&!it(this.root)?k(this.root):(e=(t=it(this.root)?this.root:g).documentElement,t=t.body,{top:0,left:0,right:e.clientWidth||t.clientWidth,width:e.clientWidth||t.clientWidth,bottom:e.clientHeight||t.clientHeight,height:e.clientHeight||t.clientHeight}),this._expandRectByRootMargin(e)},i.prototype._expandRectByRootMargin=function(n){var t=this._rootMarginValues.map(function(t,e){return"px"==t.unit?t.value:t.value*(e%2?n.width:n.height)/100}),t={top:n.top-t[0],right:n.right+t[1],bottom:n.bottom+t[2],left:n.left-t[3]};return t.width=t.right-t.left,t.height=t.bottom-t.top,t},i.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,i=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==i)for(var o=0;o<this.thresholds.length;o++){var r=this.thresholds[o];if(r==n||r==i||r<n!=r<i)return!0}},i.prototype._rootIsInDom=function(){return!this.root||nt(g,this.root)},i.prototype._rootContainsTarget=function(t){var e=this.root&&(this.root.ownerDocument||this.root)||g;return nt(e,t)&&(!this.root||e==t.ownerDocument)},i.prototype._registerInstance=function(){n.indexOf(this)<0&&n.push(this)},i.prototype._unregisterInstance=function(){var t=n.indexOf(this);-1!=t&&n.splice(t,1)},window.IntersectionObserver=i,window.IntersectionObserverEntry=Q));function S(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var n,i=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];for(n in i)void 0!==i[n]&&(t[n]=i[n])}return t}function R(t){var e,n="?";for(e in t)n+=e+"="+t[e]+"&";return n.substring(0,n.length-1)}function ot(){return"undefined"!=typeof window&&"function"==typeof XMLHttpRequest?f.web:"undefined"!=typeof wx&&wx.getSystemInfo?f.wx:"undefined"!=typeof tt&&tt.getSystemInfo?f.tt:"undefined"!=typeof serviceWorker?f.serviceWorker:null}var A,C,P,D=ot(),rt=Date.now();function st(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}var U,M=function(){function t(){r(this,t),this.silent=!1,this.env="development",this.sessionTimeout=1800,this.initInfo={},this.api=B,this.tokenKey="vmsxtoken",this.is_track_timeOnPage=!1,this.uuid=st(),this.extraApiHeaders={}}return a(t,[{key:"getUserId",value:function(){var t,e=this.getStorage(F);if(e){try{if("string"!=typeof e)return null==(t=e)?void 0:t.data}catch(t){}return e}return e="visitor_"+J(),this.setStorage(F,e),e}},{key:"init",value:function(t){var e=t.user_id,n=t.tenant_id,i=t.global_user_id,o=t.env,o=void 0===o?"development":o,r=t.silent,s=t.sessionTimeout,s=void 0===s?1800:s,a=t.distinct_id,u=t.tokenKey,c=t.is_track_timeOnPage,c=void 0!==c&&c,l=t.apiConfig,l=void 0===l?{development:q,production:B}:l,t=t.extraApiHeaders,t=void 0===t?{}:t;this.silent=void 0!==r&&r,this.sessionTimeout=s,this.env=o,this.api=l[o]||q,this.extraApiHeaders=t,this.is_track_timeOnPage=c,this.initInfo.user_id=String(e||this.getUserId()),this.initInfo.tenant_id=n,this.initInfo.global_user_id=String(i),this.initInfo.distinct_id=a,this.initInfo.link_id={},this.initSession(),u&&(this.tokenKey=u)}},{key:"setGlobalData",value:function(t){S(this.initInfo,t)}},{key:"setExtraApiHeaders",value:function(t){this.extraApiHeaders=s(s({},this.extraApiHeaders),t)}},{key:"visit",value:function(){var t;this.refreshSession(),this.silent||(t=S({event_time:T()},this.getSysInfo(),this.initInfo),this.send(t))}},{key:"updateUuid",value:function(){this.uuid=st()}},{key:"track",value:function(t){var e,n,i,o,r;!this.silent&&this.initInfo.tenant_id&&("Page_View"===t.event_type_code&&(r=t,A=Date.now(),A=A-rt,f.web===D&&(n=window.location.pathname+window.location.hash,P=(null==(o=r.event_properties)?void 0:o.url)||window.location.href,r.event_properties={url:P,host:(null==(o=r.event_properties)?void 0:o.host)||window.location.host,path:(null==(o=r.event_properties)?void 0:o.path)||n,preUrl:C,stay_time:A}),f.wx===D&&(n=(o=getCurrentPages())[o.length-1],n=o.length&&n?(o=n.options,e=p+n.is+R(o),n.is+R(o)):(e=p+"404","404"),P=(null==(o=r.event_properties)?void 0:o.url)||e,r.event_properties={url:P,host:(null==(o=r.event_properties)?void 0:o.host)||p,path:(null==(e=r.event_properties)?void 0:e.path)||n,preUrl:C,stay_time:A}),f.tt===D&&(e=(o=getCurrentPages())[o.length-1],o=o.length&&e?(n=e.options,i=v+e.is+R(n),e.is+R(n)):(i=v+"404","404"),P=(null==(e=r.event_properties)?void 0:e.url)||i,r.event_properties={url:P,host:(null==(n=r.event_properties)?void 0:n.host)||v,path:(null==(e=r.event_properties)?void 0:e.path)||o,preUrl:C,stay_time:A}),C=P,rt=Date.now(),this.is_track_timeOnPage&&null!=t&&null!=(i=t.event_properties)&&i.preUrl&&(e=S({event_time:T(),url:this.getUrl(),event_type_code:"Common_Page_Stay_Time",event_properties:{stay_time:null==t||null==(n=t.event_properties)?void 0:n.stay_time,url:null==t||null==(r=t.event_properties)?void 0:r.preUrl}},this.getSysInfo(),this.initInfo),this.send(e)),null!=t&&null!=(o=t.event_properties)&&delete o.preUrl,null!=t&&null!=(r=t.event_properties)&&delete r.stay_time),this.initInfo.link_id=s(s({},this.initInfo.link_id),{},u({},t.event_type_code,this.uuid)),r=S({event_time:T(),cur_url:this.getUrl(),token:this.getToken()},this.getSysInfo(),this.initInfo,t),this.send(r))}}]),t}(),e=function(){t(n,M);var e=l(n);function n(){var t;return r(this,n),u(c(t=e.call(this)),"dataList",[]),u(c(t),"dataAllList",[]),u(c(t),"trackEvent",{eventCode:"",eventChanel:""}),u(c(t),"time",2e3),u(c(t),"timer",0),u(c(t),"container","#scrollExposureContainer"),u(c(t),"maxNum",20),u(c(t),"observer",void 0),t.platform=f.web,t.sysInfo=t.initSysInfo(),t}return a(n,[{key:"setStorage",value:function(t,e){localStorage.setItem(t,JSON.stringify(e))}},{key:"getStorage",value:function(t){t=localStorage.getItem(t);return t=t&&JSON.parse(t)}},{key:"getSysInfo",value:function(){return this.sysInfo}},{key:"initSysInfo",value:function(){var t=H(),e=G();return{os:e.name,os_version:e.version,user_agent:t.userAgent,browser:t.type,browser_version:t.versions,source_from:e.isMobile?"h5":"web",device_id:""}}},{key:"getUrl",value:function(){return window.location.href}},{key:"getToken",value:function(){return this.getStorage(this.tokenKey)||""}},{key:"initSession",value:function(){this.getUrl().match(W)?this.refreshSession():this.initInfo.session=_()}},{key:"refreshSession",value:function(){var t,e,n=this.initInfo.session;n?(t=n.lastIndexOf("."),e=b(n.substr(t+1,6)),Math.round(Date.now()/1e3)-e>this.sessionTimeout?this.initInfo.session=_():this.initInfo.session=n.substring(0,t)+"."+w()):this.initInfo.session=_()}},{key:"send",value:function(t){try{var e=new XMLHttpRequest;e.open("POST",this.api,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){var t;4!==e.readyState||200===e.status&&e.responseText||e.responseText&&(t=JSON.parse(e.responseText),console.warn("埋点失败",t))},e.send(JSON.stringify(t))}catch(t){}}},{key:"exposureInit",value:function(t,e,n){var a=this;n&&(a.container=n),e&&(a.maxNum=e),t&&(a.time=t),a.observer=new IntersectionObserver(function(t){t.forEach(function(t){if(t.isIntersecting)try{a.timer&&clearTimeout(a.timer);var e,n=t.target.attributes["data-exposure-param"].value,i=JSON.parse(n),o=localStorage.getItem("exposureCode");if(a.trackEvent.eventCode&&a.trackEvent.eventCode!==o&&localStorage.setItem("exposureCode",i.code),!i.id)return;var r={exposureId:i.id,exposureUrl:i.url},s={exposureId:i.id,exposureUrl:i.url,exposureCode:i.code};a.dataList.push(r),a.dataAllList.push(s),a.trackEvent={eventCode:i.code,eventChanel:i.channel},null!=(e=a.observer)&&e.unobserve(t.target),a.dataList.length>=a.maxNum?a.sendData():0<a.dataList.length&&(a.timer=window.setTimeout(function(){a.sendData()},a.time))}catch(t){console.log("暴露埋点error: ",t)}})},{root:document.querySelector(a.container),rootMargin:"0px",threshold:.5})}},{key:"add",value:function(t){var e=(t||{}).el,t=null==(t=this.dataAllList)?void 0:t.find(function(t){return"".concat("exposure-content-").concat(t.exposureId)===(null==e?void 0:e.id)&&t.exposureCode===e.dataset.exposureCode});this.observer&&e&&!t&&this.observer.observe(e)}},{key:"sendData",value:function(){var t=this.dataList.splice(0,this.maxNum),t={event_time:T(),event_type_code:this.trackEvent.eventCode,event_properties:{channel:this.trackEvent.eventChanel,exposure_params:JSON.stringify(t)}};this.track(t)}}]),n}(),at=function(){function e(){r(this,e)}return a(e,null,[{key:"createEventHandler",value:function(o){return function(t){for(var e=t.target;e&&e!==document;){var n=e.getAttribute.bind(e),i=n("data-track-click");if(i){try{i=JSON.parse(i),o(i)}catch(t){}if("true"!==n("data-track-bubble"))break}if(!(e=e.parentNode))break}}}},{key:"bindEvent",value:function(t){e.eventhandler||(e.eventhandler=e.createEventHandler(t),document.addEventListener("click",e.eventhandler))}},{key:"removeEvent",value:function(){e.eventhandler&&(document.removeEventListener("click",e.eventhandler),e.eventhandler=void 0)}}]),e}(),e=(new e,function(){t(n,M);var e=l(n);function n(){var t;return r(this,n),(t=e.call(this)).platform=f.web,t.sysInfo=t.initSysInfo(),t}return a(n,[{key:"setStorage",value:function(t,e){localStorage.setItem(t,JSON.stringify(e))}},{key:"getStorage",value:function(t){try{var e=localStorage.getItem(t);return e?JSON.parse(e):void 0}catch(t){return}}},{key:"getSysInfo",value:function(){return this.sysInfo}},{key:"initSysInfo",value:function(){var t=H(),e=G();return{os:e.name,os_version:e.version,user_agent:t.userAgent,browser:t.type,browser_version:t.versions,source_from:e.isMobile?"h5":"web",device_id:"",window_width:window.innerWidth,window_height:window.innerHeight,resolution:"".concat(window.screen.width,"*").concat(window.screen.height),timezone:K(window),language:z.get(V),preferred_locale:window.navigator.language}}},{key:"getUrl",value:function(){return window.location.href}},{key:"getToken",value:function(){return window.localStorage.getItem(this.tokenKey)||""}},{key:"initSession",value:function(){this.getUrl().match(W)?this.refreshSession():this.initInfo.session=_()}},{key:"refreshSession",value:function(){var t,e,n=this.initInfo.session;n?(t=n.lastIndexOf("."),e=b(n.substr(t+1,6)),Math.round(Date.now()/1e3)-e>this.sessionTimeout?this.initInfo.session=_():this.initInfo.session=n.substring(0,t)+"."+w()):this.initInfo.session=_()}},{key:"send",value:function(t){var e=this;try{var n=new XMLHttpRequest;n.open("POST",this.api,!0),n.setRequestHeader("Content-Type","application/json"),Object.keys(this.extraApiHeaders).forEach(function(t){n.setRequestHeader(t,e.extraApiHeaders[t])}),n.onreadystatechange=function(){var t;4!==n.readyState||200===n.status&&n.responseText||n.responseText&&(t=JSON.parse(n.responseText),console.warn("埋点失败",t))},n.send(JSON.stringify(t))}catch(t){}}}],[{key:"initClickTrack",value:function(t){var e=new n;return e.init(t),at.bindEvent(e.track.bind(e)),at}}]),n}()),ut=function(){t(o,M);var i=l(o);function o(t,e){var n;return r(this,o),(n=i.call(this)).global=t,n.sourceForm=e,n.sysInfo=n.initSysInfo(),n}return a(o,[{key:"setStorage",value:function(t,e){this.global.setStorageSync(t,e)}},{key:"getStorage",value:function(t){return this.global.getStorageSync(t)}},{key:"getSysInfo",value:function(){return this.sysInfo}},{key:"initSession",value:function(){this.getStorage(d)?this.refreshSession():this.initInfo.session=_()}},{key:"refreshSession",value:function(){var t=this.getStorage(d)||"",e=t.lastIndexOf("."),n=b(t.substr(e+1,6));Math.round(Date.now()/1e3)-n>this.sessionTimeout?this.initInfo.session=_():(n=t.substring(0,e)+"."+w(),this.setStorage(d,n),this.initInfo.session=n)}},{key:"send",value:function(t){this.global.request({url:this.api,method:"POST",data:t,header:s({"content-type":"application/json"},this.extraApiHeaders),success:function(t){}})}},{key:"getToken",value:function(){return this.getStorage(this.tokenKey)||""}},{key:"initSysInfo",value:function(){var t=this.global.getSystemInfoSync();return{os:t.system,os_version:t.version,user_agent:"",browser:"",browser_version:"",source_from:this.sourceForm,device_id:t.model,window_width:t.windowWidth,window_height:t.windowHeight,resolution:"".concat(t.screenWidth,"*").concat(t.screenHeight),timezone:K(this.global),language:this.global.getStorageSync(V)||"",preferred_locale:t.language}}}],[{key:"initClickTrack",value:function(t){console.warn("小程序环境不支持无侵入点击埋点事件绑定")}}]),o}(),ct=(u(ut,"initExposureTrack",function(t){console.warn("小程序环境不支持无侵入暴露埋点事件绑定")}),function(){t(n,ut);var e=l(n);function n(){var t;return r(this,n),u(c(t=e.call(this,wx,"weapp")),"platform",f.wx),u(c(t),"host",p),t}return a(n,[{key:"getUrl",value:function(){var t=getCurrentPages(),e=t[t.length-1];if(!t.length||!e)return this.host+"404";t=e.route,e=e.options;return this.host+t+R(e)}}]),n}()),lt=function(){t(n,ut);var e=l(n);function n(){var t;return r(this,n),u(c(t=e.call(this,tt,"tt")),"platform",f.tt),u(c(t),"host",v),t}return a(n,[{key:"getUrl",value:function(){var t=getCurrentPages(),e=t[t.length-1];if(!t.length||!e)return this.host+"404";t=e.options;return this.host+e.is+R(t)}}]),n}(),ht=function(){function t(){r(this,t)}return a(t,[{key:"init",value:function(){}},{key:"track",value:function(){}},{key:"updateUuid",value:function(){}},{key:"setGlobalData",value:function(){}},{key:"setExtraApiHeaders",value:function(){}}],[{key:"initClickTrack",value:function(t){}}]),t}(),e=(u(ht,"initExposureTrack",function(t){}),u(U={},f.web,e),u(U,f.wx,ct),u(U,f.tt,lt),U),ct=ot();return ct&&e[ct]||ht});
